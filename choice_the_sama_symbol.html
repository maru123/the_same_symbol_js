<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>ChoiceTheSameSymbol</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.min.css" />
    <link rel="stylesheet" type="text/css" href="./choice_the_same_symbol.css">
  </head>
  <body>
    <h1 id="title">ChoiceTheSameSymbol</h1>
    <div id="game">
      <p>神経衰弱ゲームのペア数を入力してください。</p>
      <input id="entry-set-count" type="number" maxlength="4" value="3"></input>
      <button type="button" id="reset">RESET</button>
      <div>failedCount : <p id="failed-count"></p></div>
      <div id="stage"></div>
    </div>
    <script type="text/javascript" src="./choice_the_same_symbol.js" charaset="UTF-8"></script>
    <script type="text/javascript">
    var GameComponent = function(){
      this.entrySetCount = document.getElementById("entry-set-count")
      this.failedCountElement = document.getElementById("failed-count");
      this.stage = document.getElementById("stage");
      this.choiceTheSameSymbol = new ChoiceTheSameSymbol();
      this.symboleElements = [];
      this.choicedIds = [];
      document.getElementById('reset').addEventListener('click', this.reset.bind(this));
    };
    GameComponent.prototype.reset = function(){
      this.failedCountElement.innerHTML = 0;
      this.choiceTheSameSymbol.reset(this.entrySetCount.value);
      this.choicedIds = [];
      //Remove element
      for (var i = 0 ; i < this.symboleElements.length ; i++){
        var symbolElement = document.getElementById(this.symboleElements[i].symbol.id)
        this.symboleElements[i].remove(symbolElement);
      }
      this.symboleElements = [];
      //Add element
      for (var i = 0 ; i < this.choiceTheSameSymbol.symbols.length ; i++){
        this.symboleElements.push(new SymbolElement(this.stage,this.choiceTheSameSymbol.symbols[i],this.check.bind(this)));
      }
    };
    GameComponent.prototype.check = function(id){
      if (document.getElementById(id).className === "closed"){
        this.choicedIds.push(id);
        document.getElementById(id).className = "opened";
        var result = this.choiceTheSameSymbol.choice(id);
        //戻り値がfalse(pair不成立)のとき、かつ３枚目のカードクリック時に、直前の２枚を閉じる
        if ( result === "first" && this.choicedIds.length === 3 ){
          document.getElementById(this.choicedIds[0]).className = "closed";
          document.getElementById(this.choicedIds[1]).className = "closed";
          this.choicedIds.splice(0,2);
          this.failedCountElement.innerHTML = this.choiceTheSameSymbol.failedCount;
        }
        //戻り値がtrue(pair成立)のとき
        if (result === true ){
          this.choicedIds = [];
        };
      };
    };
    var gameComponent = new GameComponent();
    </script>
  </body>
</html>
